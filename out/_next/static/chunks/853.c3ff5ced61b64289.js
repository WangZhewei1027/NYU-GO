"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[853],{7853:(e,t,s)=>{s.r(t),s.d(t,{default:()=>G});var a=s(5155),l=s(2115),r=s(4085),n=s(2432),i=s(1826),o=s(648),c=s(9923),d=s(9602);let u=c.bL,m=c.l9,x=c.ZL,h=c.bm,f=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(c.hJ,{ref:t,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...l})});f.displayName=c.hJ.displayName;let p=l.forwardRef((e,t)=>{let{className:s,children:l,...r}=e;return(0,a.jsxs)(x,{children:[(0,a.jsx)(f,{}),(0,a.jsx)(c.UC,{ref:t,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r,children:l})]})});p.displayName=c.UC.displayName;let j=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};j.displayName="DialogHeader";let g=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};g.displayName="DialogFooter";let v=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(c.hE,{ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",s),...l})});v.displayName=c.hE.displayName;let N=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(c.VY,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",s),...l})});N.displayName=c.VY.displayName;var b=s(6688);function w(e){let{route:t,isFrom:s,callback:i,defaultStop:c}=e,[d,x]=(0,l.useState)(c),[f,w]=(0,l.useState)([]),y=(0,l.useRef)(null),S=(0,l.useRef)(null);return(0,b.P)(e=>e.currentLocation),(0,l.useEffect)(()=>{(async function(){try{let e=await (0,n.rn)(t);w(e)}catch(e){console.error("Error fetching stops:",e)}})()},[t]),(0,l.useEffect)(()=>{x(c),i(c||"-")},[c]),(0,l.useLayoutEffect)(()=>{if(S.current&&y.current){let e=S.current.scrollHeight;y.current.style.height="".concat(e,"px")}},[S.current]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",className:"p-2 text-base w-full max-w-full flex items-center justify-between",children:[(0,a.jsx)("span",{className:"truncate",children:d}),(0,a.jsx)(o.q0c,{className:"shrink-0 text-gray-500"})]})}),(0,a.jsxs)(p,{className:"max-w-[85vw] rounded-lg",children:[(0,a.jsxs)(j,{children:[(0,a.jsxs)(v,{children:["Select ",s?"Departure":"Arrival"," Stop"]}),(0,a.jsx)(N,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Anyone who has this link will be able to view this."})})]}),(0,a.jsxs)("div",{className:"relative w-full max-h-[50vh] overflow-y-auto",ref:S,children:[(0,a.jsx)("div",{ref:y,className:"absolute top-0 left-[23.5px] w-0.5 ".concat(n.JZ[t].bgColor," min-h-full")}),f.map((e,l)=>(0,a.jsxs)("div",{className:"relative flex items-center pl-12 pr-4 py-4 transition transform active:scale-95 active:opacity-80 ",onClick:()=>{var a;x(e),i(e),localStorage.setItem("route_".concat(t,"_").concat(s),e),null===(a=document.querySelector('[data-state="open"]'))||void 0===a||a.click()},children:[(0,a.jsx)("div",{className:"absolute left-4 w-4 h-4 rounded-full border-2 ".concat(d===e?"".concat(n.JZ[t].bgColor," border-white shadow"):"bg-white ".concat(n.JZ[t].borderColor))}),(0,a.jsx)("div",{className:"text-base",children:e})]},l))]}),(0,a.jsx)(g,{className:"sm:justify-start",children:(0,a.jsx)(h,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"secondary",children:"Close"})})})]})]})})}function y(e){let{isOpen:t,onClose:s,name:r,from:c,to:d}=e,[u,m]=(0,l.useState)(c),[x,h]=(0,l.useState)(d),[f,p]=(0,l.useState)([]),[j,g]=(0,l.useState)([]),[v,N]=(0,l.useState)(null),b=(0,l.useRef)(null);return(0,l.useEffect)(()=>{t&&b.current&&b.current.focus()},[t]),(0,l.useEffect)(()=>{(async()=>{let{fromSchedule:e,toSchedule:t}=await (0,n.A0)(r,u,x);p(e),g(t)})()},[r,u,x]),(0,l.useEffect)(()=>{m(c),h(d)},[c,d]),(0,l.useEffect)(()=>{for(let e=0;e<f.length;e++){let[t,s]=f[e].split(" "),[a,l]=t.split(":").map(Number);"PM"===s&&12!==a&&(a+=12);let r=new Date;if(60*a+l>=60*r.getHours()+r.getMinutes()){N(e);break}}},[f,j]),(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 !mt-0"}),(0,a.jsxs)(i.P.div,{ref:b,tabIndex:-1,className:"fixed !top-0 !mt-0 right-0 h-full w-full bg-white z-50 outline-none flex flex-col safe-area",initial:{x:"100%"},animate:{x:t?0:"100%"},transition:{type:"spring",stiffness:300,damping:30},drag:"x",dragConstraints:{left:0,right:0},dragElastic:.2,onDragEnd:(e,t)=>{t.offset.x>100&&s()},children:[(0,a.jsxs)("div",{className:"p-4 flex items-center",children:[(0,a.jsx)(o.xKz,{className:"cursor-pointer text-2xl",onClick:s}),(0,a.jsx)("span",{className:"text-lg ml-2 font-bold",onClick:s,children:"Back"})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold px-4",children:["Route ",r]}),(0,a.jsxs)("div",{className:"flex p-4 border-b items-center",children:[(0,a.jsx)("div",{className:"flex-1 overflow-hidden whitespace-nowrap text-ellipsis",children:(0,a.jsx)(w,{route:r,isFrom:!0,callback:m,defaultStop:c})}),(0,a.jsx)(o.MTo,{className:"mx-1 flex-shrink-0"}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden whitespace-nowrap text-ellipsis",children:(0,a.jsx)(w,{route:r,isFrom:!1,callback:h,defaultStop:d})})]}),(0,a.jsxs)("div",{className:"flex px-4 overflow-y-auto",children:[(0,a.jsx)("div",{className:"w-1/2",children:f.map((e,t)=>(0,a.jsx)("div",{className:"text-center mt-2 h-6 ".concat(t===v?"bg-slate-300 animate-pulse font-bold rounded-l-lg":""),children:e},t))}),(0,a.jsxs)("div",{className:"w-1/2",children:[j.map((e,t)=>(0,a.jsx)("div",{className:"text-center mt-2 h-6 ".concat(t===v?"bg-slate-300 animate-pulse font-bold rounded-r-lg":""),children:e},t)),(0,a.jsx)("div",{className:"w-full h-16"})]})]})]})]})}function S(e){let{time:t,route:s}=e;return(0,a.jsx)("div",{className:"ml-auto pr-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"ml-0",children:[Number(t)>=60&&(0,a.jsxs)("span",{className:"inline",children:[(0,a.jsx)("span",{className:"inline text-4xl font-mono",children:Math.floor(Number(t)/60)}),(0,a.jsx)("span",{className:"inline ml-1 mr-1 text-gray-500 text-end",children:"h"})]}),(0,a.jsx)("span",{className:"inline text-4xl font-mono",children:"--"===t?"--":Number(t)%60}),"--"!==t&&(0,a.jsx)("span",{className:"inline ml-1 text-gray-500 text-end",children:"min"})]})})}function k(e){let{route:t,isFrom:s,callback:i}=e,[c,d]=(0,l.useState)("Select Stop"),[x,f]=(0,l.useState)([]),[w,y]=(0,l.useState)(!1),S=(0,l.useRef)(null),k=(0,l.useRef)(null),C=(0,b.P)(e=>e.currentLocation);function E(){k.current&&S.current&&(console.log("\uD83D\uDCCF 计算竖线高度:",k.current.scrollHeight),S.current.style.height="".concat(k.current.scrollHeight,"px"))}return(0,l.useEffect)(()=>{(async function(){try{let e=await (0,n.rn)(t);f(e)}catch(e){console.error("Error fetching stops:",e)}})()},[t]),(0,l.useEffect)(()=>{let e=localStorage.getItem("route_".concat(t,"_").concat(s));e&&(d(e),i(e))},[]),(0,l.useEffect)(()=>{s&&C&&(d(C),i(C))},[C]),(0,l.useEffect)(()=>{w&&requestAnimationFrame(E)},[w,x]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u,{open:w,onOpenChange:y,children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",className:"p-2 text-base w-full max-w-full flex items-center justify-between shadow-none",children:[(0,a.jsx)("span",{className:"truncate",children:c}),(0,a.jsx)(o.q0c,{className:"shrink-0 text-gray-500"})]})}),(0,a.jsxs)(p,{className:"max-w-[85vw] rounded-lg",children:[(0,a.jsxs)(j,{children:[(0,a.jsxs)(v,{children:["Select ",s?"Departure":"Arrival"," Stop"]}),(0,a.jsx)(N,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Anyone who has this link will be able to view this."})})]}),(0,a.jsxs)("div",{className:"relative w-full max-h-[50vh] overflow-y-auto",ref:k,children:[(0,a.jsx)("div",{ref:S,className:"absolute top-0 left-[23.5px] w-0.5 ".concat(n.JZ[t].bgColor," min-h-full")}),x.map((e,l)=>(0,a.jsxs)("div",{className:"relative flex items-center pl-12 pr-4 py-4 transition transform",onClick:()=>{var a;d(e),i(e),localStorage.setItem("route_".concat(t,"_").concat(s),e),null===(a=document.querySelector('[data-state="open"]'))||void 0===a||a.click()},children:[(0,a.jsx)("div",{className:"absolute left-4 w-4 h-4 rounded-full border-2 ".concat(c===e?"".concat(n.JZ[t].bgColor," border-white shadow"):"bg-white ".concat(n.JZ[t].borderColor))}),(0,a.jsx)("div",{className:"text-base",children:e})]},l))]}),(0,a.jsx)(g,{className:"sm:justify-start",children:(0,a.jsx)(h,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"secondary",children:"Close"})})})]})]})})}function C(e){let{route:t,isFrom:s,callback:l,stops:r}=e;return(0,a.jsxs)("div",{className:"w-full mt-2 truncate",children:[(0,a.jsx)(k,{route:t,isFrom:s,callback:l}),r.map((e,t)=>(0,a.jsx)("div",{className:"text-base text-center mt-2",children:e},t))]})}var E=s(4461);function M(e){let{route:t,promo:s}=e,[r,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{"true"===localStorage.getItem(t)?n(!0):n(!1)},[]),(0,a.jsxs)("div",{className:"w-full h-40 shadow rounded p-4 flex flex-col transition-all ".concat(r?"bg-egg-blue-400 text-white":"bg-white text-black"),onClick:()=>{n(!r),localStorage.setItem(t,(!r).toString())},children:[(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsxs)("span",{className:"text-lg font-bold",children:["Route ",t]}),(0,a.jsx)(o.lEn,{className:"ml-auto w-6 h-6 shadow-none text-white"})]}),(0,a.jsx)("p",{className:"text-sm mt-6",children:s})]})}function P(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsx)("div",{className:"flex items-center justify-cente w-full border px-2 rounded-full",children:(0,a.jsxs)(r.$,{variant:"ghost",className:"p-1 text-base w-full max-w-full  text-gray-400",children:[(0,a.jsx)(o.Raw,{className:"shrink-0 text-gray-400"}),"Add Routes"]})})}),(0,a.jsxs)(p,{className:"max-w-[90vw] max-h-[100vh] overflow-hidden p-4 rounded",children:[(0,a.jsxs)(j,{children:[(0,a.jsx)(v,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Add Routes"})}),(0,a.jsx)(N,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Add Routes"})})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(n.JZ).map((e,t)=>(0,a.jsx)(M,{route:e,promo:n.JZ[e].promo},t))}),(0,a.jsx)(g,{className:"relative",children:(0,a.jsx)(h,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"outline",className:"fixed h-10 w-20 bottom-12 left-1/2 transform -translate-x-1/2 border border-egg-blue-400 rounded-full text-egg-blue-400 text-base z-50",children:"Close"})})})]})]})})}var I=s(9847);let _=e=>{let{shouldScaleBackground:t=!0,...s}=e;return(0,a.jsx)(I._s.Root,{shouldScaleBackground:t,...s})};_.displayName="Drawer";let R=I._s.Trigger,O=I._s.Portal;I._s.Close;let D=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(I._s.Overlay,{ref:t,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",s),...l})});D.displayName=I._s.Overlay.displayName;let F=l.forwardRef((e,t)=>{let{className:s,children:l,...r}=e;return(0,a.jsxs)(O,{children:[(0,a.jsx)(D,{}),(0,a.jsxs)(I._s.Content,{ref:t,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",s),...r,children:[(0,a.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),l]})]})});F.displayName="DrawerContent";let J=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,d.cn)("grid gap-1.5 p-0 text-center sm:text-left",t),...s})};J.displayName="DrawerHeader";let L=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,d.cn)("mt-auto flex flex-col gap-2 p-0",t),...s})};L.displayName="DrawerFooter";let A=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(I._s.Title,{ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",s),...l})});A.displayName=I._s.Title.displayName;let $=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)(I._s.Description,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",s),...l})});$.displayName=I._s.Description.displayName;let Z=l.forwardRef((e,t)=>{let{className:s,type:l,...r}=e;return(0,a.jsx)("input",{type:l,className:(0,d.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});Z.displayName="Input";var z=s(2434),q=s(4389),B=s(3032);function H(){let[e,t]=(0,l.useState)(null),[s,c]=(0,l.useState)(""),[d,u]=(0,l.useState)("-"),[m,x]=(0,l.useState)(b.P.getState().stopsData),[h,f]=(0,l.useState)(JSON.parse(localStorage.getItem("bookmarkedStops")||"[]")),[p,j]=(0,l.useState)(null),g=(0,b.P)(e=>e.location),[v,N]=(0,l.useState)(!0),w=(0,b.P)(e=>e.updateCurrentLocation);(0,l.useEffect)(()=>{t(b.P.getState().stopsData);let e=localStorage.getItem("currentLocation")||"715 Broadway";u(e),w(e)},[]),(0,l.useEffect)(()=>{if(v&&g&&e&&g&&e){let t=1/0,s=null;if(Object.entries(e).forEach(e=>{let[a,l]=e,r=(0,q.$)(g.latitude,g.longitude,l.position.latitude,l.position.longitude);r<t&&(t=r,s=a)}),s){j(s),u(s);return}}},[g,e,v]);let y=e=>{if(c(e),!e){x(b.P.getState().stopsData);return}let t=b.P.getState().stopsData;x(Object.keys(t).reduce((s,a)=>((0,z.A)(a,e)&&(s[a]=t[a]),s),{}))},S=e=>{let t=h.includes(e)?h.filter(t=>t!==e):[...h,e];f(t),localStorage.setItem("bookmarkedStops",JSON.stringify(t))},k=(0,l.useMemo)(()=>m?Object.entries(m).sort((e,t)=>{let[s]=e,[a]=t;return(h.includes(s)?-1:1)-(h.includes(a)?-1:1)}):[],[m,h]),C=e=>{u(e),w(e),N(!1),localStorage.setItem("currentLocation",e);let t=document.querySelector('[data-state="open"]');t instanceof HTMLElement&&t.click()},E=e=>{let{stopKey:t,value:s,showBookmark:l=!0}=e;return(0,a.jsxs)("div",{className:"flex flex-row py-4 border-b transition transform active:scale-95 active:opacity-80",onClick:()=>C(t),children:[(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[(0,a.jsx)("div",{className:"text-lg mb-1 inline",children:t}),(0,a.jsx)("div",{children:s.routes.map((e,t)=>{var s;return(0,a.jsx)("div",{className:"inline mr-2 p-3 py-1 text-xs rounded-md ".concat(null===(s=n.JZ[e])||void 0===s?void 0:s.bgColor," text-gray-900 font-bold"),children:e},t)})})]}),l&&(0,a.jsx)("div",{className:"flex flex-col justify-center",children:h.includes(t)?(0,a.jsx)(o.cgZ,{className:"ml-2 text-amber-400 w-7 h-7",onClick:e=>{e.stopPropagation(),S(t)}}):(0,a.jsx)(o.WKI,{className:"ml-2 text-gray-500 w-7 h-7",onClick:e=>{e.stopPropagation(),S(t)}})})]})};return(0,a.jsxs)(_,{children:[(0,a.jsx)(R,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",className:"p-1 text-base w-full max-w-full",children:[(0,a.jsx)(o.Cud,{className:"shrink-0 text-gray-500"}),(0,a.jsx)("span",{className:"truncate",children:d})]})}),(0,a.jsxs)(F,{className:"h-[85vh]",children:[(0,a.jsxs)(J,{children:[(0,a.jsx)(A,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden p-0",children:"Select Location"})}),(0,a.jsx)($,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden p-0",children:"Select Location"})})]}),(0,a.jsxs)("div",{className:"flex justify-center w-full py-4",style:{boxShadow:"0 4px 4px -3px rgba(0, 0, 0, 0.1)"},children:[(0,a.jsx)(Z,{placeholder:"Search a stop",className:"w-[55%] shadow-none rounded-full text-lg",value:s,onChange:e=>y(e.target.value)}),(0,a.jsx)(o.EO$,{className:"w-8 h-8 text-gray-400 ml-2"})]}),(0,a.jsxs)("div",{className:"flex flex-col h-full overflow-y-auto px-8",children:[(0,a.jsxs)(B.o,{children:[(0,a.jsx)(i.P.div,{layoutId:"nearest-stop",children:p&&(0,a.jsx)(t=>{var s;let{stopKey:l}=t;return(0,a.jsx)("div",{className:"flex flex-row py-8 border-b transition transform active:scale-95 active:opacity-80",onClick:()=>C(l),children:(0,a.jsxs)("div",{className:"flex flex-col w-full justify-center",children:[(0,a.jsx)("div",{className:"mb-1",children:(0,a.jsxs)("div",{className:"text-sm text-gray-400 mb-1 inline animate-pulse",children:[(0,a.jsx)(o.Ohz,{className:"inline mr-1"}),(0,a.jsx)("span",{className:"align-text-top font-bold",children:"Nearest Stop"})]})}),(0,a.jsxs)("div",{className:"block",children:[(0,a.jsx)("div",{className:"text-lg mb-1 inline",children:l}),(0,a.jsx)("div",{children:e&&(null===(s=e[l])||void 0===s?void 0:s.routes.map((e,t)=>{var s;return(0,a.jsx)("div",{className:"inline mr-2 p-3 py-1 text-xs rounded-md ".concat(null===(s=n.JZ[e])||void 0===s?void 0:s.bgColor," text-gray-900 font-bold"),children:e},t)}))})]})]})})},{stopKey:p})},"nearest-stop"),k.map(e=>{let[t,s]=e;return(0,a.jsx)(i.P.div,{layout:!0,layoutId:t,transition:{layout:{duration:.5,ease:"easeInOut"}},children:(0,a.jsx)(E,{stopKey:t,value:s})},t)})]}),0===Object.keys(m).length&&(0,a.jsx)("div",{className:"text-center text-gray-400 py-4 text-lg font-bold",children:"No stop found"})]}),(0,a.jsx)(L,{})]})]})}var T=s(8422);let K=[{name:"A",time:"4",color:"pink"},{name:"B",time:"5",color:"purple"},{name:"C",time:"8",color:"yellow"},{name:"E",time:"8",color:"yellow"},{name:"F",time:"3",color:"green"},{name:"G",time:"6",color:"cyan"},{name:"W",time:"7",color:"amber"}],V=(0,l.memo)(function(e){var t;let{name:s}=e,{time:i,actualTime:c,stopFrom:d,stopTo:u,currentStopFrom:m,currentStopTo:x,setCurrentStopFrom:h,setCurrentStopTo:f}=function(e){let[t,s]=(0,l.useState)(null),[a,r]=(0,l.useState)(null),[i,o]=(0,l.useState)(["-"]),[c,d]=(0,l.useState)(["-"]),[u,m]=(0,l.useState)(""),[x,h]=(0,l.useState)(""),f=(0,b.P)();return(0,b.P)(e=>e.currentLocation),(0,l.useEffect)(()=>{let t=async()=>{let t=await (0,n.A1)(e,f.currentLocation);s(-1===t?"--":t.toString())};t();let a=setInterval(t,5e3);return()=>clearInterval(a)},[e,f.currentLocation]),(0,l.useEffect)(()=>{(async()=>{let{fromSchedule:t,toSchedule:s}=await (0,n.fP)(e,u,x);o(t),d(s)})()},[e,u,x]),{time:t,actualTime:a,stopFrom:i,stopTo:c,currentStopFrom:u,currentStopTo:x,setCurrentStopFrom:m,setCurrentStopTo:h}}(s),[p,j]=(0,l.useState)(!1),[g,v]=(0,l.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col items-center rounded-lg shadow-sm mt-1 border-l-[8px] ".concat(null===(t=n.JZ[s])||void 0===t?void 0:t.borderColor," bg-white"),children:[(0,a.jsxs)("div",{className:"flex items-center w-full h-20",onClick:()=>j(!p),children:[(0,a.jsx)("div",{className:"ml-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline text-4xl font-mono",children:s})}),(0,a.jsx)(E.A,{routeName:s,className:"mx-4"}),(0,a.jsx)(S,{time:i,route:s})]}),(0,a.jsxs)("div",{className:"overflow-hidden transition-all duration-500 ".concat(p?"max-h-[400px] opacity-100":"max-h-0 opacity-0"," items-center w-full"),children:[(0,a.jsxs)("div",{className:"flex flex-row p-2",children:[(0,a.jsx)(C,{route:s,isFrom:!0,callback:h,stops:d}),(0,a.jsx)(o.MTo,{className:"mt-2 w-8 h-8 mx-1"}),(0,a.jsx)(C,{route:s,isFrom:!1,callback:f,stops:u})]}),(0,a.jsxs)("div",{className:"flex flex-row space-x-2 m-2 mt-6",children:[(0,a.jsx)(r.$,{onClick:()=>v(!0),variant:"outline",className:"h-12 rounded-full text-base ".concat(n.JZ[s].borderColor," ml-auto"),children:"Full Schedule"}),(0,a.jsx)(r.$,{onClick:()=>{window.location.href="/main/map"},variant:"secondary",className:"h-12 rounded-full text-base text-gray-50 ".concat(n.JZ[s].bgColor),children:"Open Map"})]})]})]}),(0,a.jsx)(y,{isOpen:g,onClose:()=>v(!1),name:s,from:m,to:x})]})});function G(){let[e,t]=(0,l.useState)([]),[s,n]=(0,l.useState)(null),i=(0,b.P)(),o=(0,l.useMemo)(()=>K.map(e=>e.name).filter(e=>"true"===localStorage.getItem(e)),[e]),c=(0,l.useCallback)(()=>{let e=K.map(e=>e.name).filter(e=>"true"===localStorage.getItem(e));t(t=>JSON.stringify(t)===JSON.stringify(e)?t:e)},[]);(0,l.useEffect)(()=>{fetch("https://nyu-go-backend-production.up.railway.app/alert-messages").then(e=>e.json()).then(e=>{n(e)}).catch(e=>{console.error("❌ 获取 alert 消息失败:",e)}),c();let e=setInterval(c,500);return i.currentLocation=localStorage.getItem("currentLocation")||"715 Broadway",()=>clearInterval(e)},[c,i]);let d=(0,l.useMemo)(()=>(0,a.jsx)(H,{}),[]);return(0,a.jsxs)("div",{className:"p-4 h-screen overflow-y-auto safe-area",children:[(0,a.jsxs)("div",{className:"flex mb-6 items-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Track"}),(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(r.$,{className:"ml-auto rounded-full p-2 w-9 h-9 relative",variant:"outline",children:[(0,a.jsx)(T.Bwk,{className:"h-4 w-4"}),(null==s?void 0:s.msgs)&&s.msgs.length>0&&(0,a.jsx)("span",{className:"absolute top-0 right-0 block w-2 h-2 rounded-full bg-red-600"})]})}),(0,a.jsx)(p,{className:"w-[90vw] rounded-lg",children:(0,a.jsxs)(j,{children:[(0,a.jsx)(v,{children:"Alert Messages"}),(0,a.jsx)(N,{}),(null==s?void 0:s.msgs)&&s.msgs.length>0?(0,a.jsx)("div",{className:"text-left",children:s.msgs.map(e=>(0,a.jsxs)("div",{className:"my-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.created}),(0,a.jsx)("div",{className:"font-bold",children:e.name}),(0,a.jsx)("div",{children:e.html})]},e.id))}):(0,a.jsx)("div",{children:"No alert messages"})]})})]})]}),(0,a.jsxs)("div",{className:"mb-8 text-base",children:["Departing from \xa0",(0,a.jsx)("div",{className:"max-w-48 inline-block",children:d}),"\xa0 in"]}),(0,a.jsxs)("div",{className:"space-y-6",children:[K.map((e,t)=>o.includes(e.name)&&(0,a.jsx)(V,{name:e.name},t)),(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("div",{className:"w-32",children:(0,a.jsx)(P,{})})}),(0,a.jsx)("div",{className:"w-full h-16"})]})]})}},4461:(e,t,s)=>{s.d(t,{A:()=>d});var a=s(5155),l=s(2432),r=s(2115),n=s(6688),i=s(2364),o=s(2434),c=s(4389);function d(e){var t;let{routeName:s,progress:d,className:u}=e,m=(0,n.P)(e=>e.unit),x=d||function(e){let t=(0,n.P)(),[s,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let s=function(e){let t=Object.values(i.Gb).find(t=>(0,o.A)(t.name,e));return t?{latitude:t.latitude,longitude:t.longitude}:(console.error("Stop ".concat(e," not found")),null)}(t.currentLocation);if(s){let l=function(e,s,a){let l=t.shuttleData;if(!l||Object.prototype.hasOwnProperty.call(l,"undefined"))return null;let r=1/0,n=null;return Object.entries(l).forEach(t=>{let[l,i]=t;if(i.route.toLowerCase()===e.toLowerCase()){let e=(0,c.$)(s,a,Number(i.latitude),Number(i.longitude));e<r&&(r=e,n={latitude:i.latitude,longitude:i.longitude})}}),n}("route "+e,s.latitude,s.longitude);l&&a(Number((0,c.$)(Number(l.latitude),Number(l.longitude),s.latitude,s.longitude)))}},[t.shuttleData,t.currentLocation,e]),s}(s),h=null===x?0:Math.min(100,Math.max(0,100*(1-Math.log1p(Math.max(0,Math.min(x,3)))/Math.log1p(3)))),f=Math.min(90,Math.max(15,h)),p=function(e,t){if(null===e)return null;if("imperial"===t){let t=.621371*e;if(t>1)return"".concat(t.toFixed(1)," mi");{let t=3280.84*e;return"".concat(t.toFixed(0)," ft")}}return e>1?"".concat(e.toFixed(1)," km"):"".concat((1e3*e).toFixed(0)," m")}(x,m);return(0,a.jsxs)("div",{className:"relative h-1 w-full rounded-full bg-gray-200 ".concat(u),children:[(0,a.jsx)("div",{className:"h-full rounded-full ".concat(null===(t=l.JZ[s])||void 0===t?void 0:t.bgColor," transition-all duration-1000"),style:{width:"".concat(h,"%")}}),(0,a.jsx)("div",{className:"absolute text-gray-500 text-sm whitespace-nowrap animate-pulse",style:{left:"".concat(f,"%"),transform:"translateX(-50%)",bottom:"100%",marginBottom:"4px"},children:null===p?"":"".concat(p)})]})}},4389:(e,t,s)=>{s.d(t,{$:()=>a});function a(e,t,s,a){let l=(s-e)*Math.PI/180,r=(a-t)*Math.PI/180,n=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}},4085:(e,t,s)=>{s.d(t,{$:()=>c,r:()=>o});var a=s(5155),l=s(2115),r=s(2317),n=s(1027),i=s(9602);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=l.forwardRef((e,t)=>{let{className:s,variant:l,size:n,asChild:c=!1,...d}=e,u=c?r.DX:"button";return(0,a.jsx)(u,{className:(0,i.cn)(o({variant:l,size:n,className:s})),ref:t,...d})});c.displayName="Button"},9602:(e,t,s)=>{s.d(t,{cn:()=>r});var a=s(3463),l=s(9795);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,l.QP)((0,a.$)(t))}}}]);