"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[255],{9636:(e,t,o)=>{o.r(t),o.d(t,{default:()=>z});var r=o(5155),n=o(833),s=o(5402),l=o(7288),a=o(3314),c=o(3710),i=o(8741),d=o.n(i),u=o(3306),m=o(2115);o(8413),o(9149),o(3919);var h=o(6176),x=o(9265),b=o(2364),p=o(6688),f=o(6756),g=o(2434);let j=e=>e<=11?0:e>=16?1:(e-11)/5,v=e=>{let{opacity:t=1}=e;return(0,r.jsx)("div",{className:"w-2 h-2 flex items-center justify-center rounded-full bg-white border-2 border-gray-500",style:{opacity:t}})},y=()=>{let e=(0,f.ko)(),[t,o]=(0,m.useState)(e.getZoom());(0,m.useEffect)(()=>{let t=()=>{o(e.getZoom())};return e.on("zoomend",t),()=>{e.off("zoomend",t)}},[e]);let n=j(t);function s(e){let{stopName:t}=e,o=p.P.getState().stopsData,n=null;for(let[e,r]of Object.entries(o))if((0,g.A)(e,t)){n=r.routes;break}return n?(0,r.jsx)("div",{children:n.map(e=>{var t;return(0,r.jsx)("span",{className:"inline mr-2 p-3 py-1 text-xs rounded-md text-gray-900 font-bold",style:{backgroundColor:null===(t=x._L[e])||void 0===t?void 0:t.color},children:e},e)})}):null}return(0,r.jsx)(r.Fragment,{children:Object.values(b.Gb).map(e=>(0,r.jsx)(c.p,{position:[e.latitude,e.longitude],icon:d().divIcon({className:"custom-stop",html:u.renderToString((0,r.jsx)(v,{opacity:n})),iconSize:[10,10],iconAnchor:[5,5]}),children:(0,r.jsxs)(a.z,{closeButton:!1,autoPan:!0,children:[(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("span",{className:"font-bold text-base",children:[" ",e.name," "]}),(0,r.jsxs)("span",{children:["(",e.id,")"]})]}),(0,r.jsx)(s,{stopName:e.name})]})},e.id))})},N=JSON.parse('{"59666":"E","59829":"C","59830":"A","59831":"B","59832":"F","59833":"G","59834":"W"}'),S=e=>{if("Ferry Route"===e)return"ferry";if(/^Route\s[A-Z]$/.test(e)){let t=e.split(" ");if(t.length<2)return"?";let o=t[1].match(/[A-Z]/i);return o?o[0].toUpperCase():"?"}return"\uD83D\uDE8D"},k=e=>{var t,o;let{letter:n,heading:s=0}=e;return(0,r.jsxs)("div",{className:"relative w-8 h-8",style:{transform:"rotate(".concat(s,"deg)"),transformOrigin:"center center",transition:"transform 0.3s ease-in-out"},children:[(0,r.jsx)("div",{className:"absolute top-[-6px] left-1/2 w-0 h-0 border-l-[10px] border-r-[10px] border-b-[10px] border-transparent border-b-black",style:{transform:"translateX(-50%)",zIndex:-1}}),(0,r.jsx)("div",{className:"w-8 h-8 flex items-center justify-center rounded-full bg-white border-2 border-gray-800 text-black ".concat(null===(t=x._L[n])||void 0===t?void 0:t.borderColor," ").concat(null===(o=x._L[n])||void 0===o?void 0:o.textColor),style:{boxShadow:"0px 5px 10px rgba(0, 0, 0, 0.25)"},children:(0,r.jsx)("div",{style:{transform:"rotate(".concat(-s,"deg)")},children:"ferry"===n?(0,r.jsx)("img",{src:"/map/ferry.svg",alt:"ferry",className:"w-4 h-4"}):(0,r.jsx)("span",{className:"font-black",children:n})})})]})},w=()=>(0,r.jsx)("div",{className:"w-2 h-2 flex items-center justify-center rounded-full bg-blue-400 border-2 border-blue-600",style:{boxShadow:"0px 5px 10px rgba(0, 0, 0, 0.25)"}});function z(){let e=(0,h.A)(),t=(0,m.useMemo)(()=>({}),[]);return(0,r.jsxs)(n.W,{center:[40.73,-73.99],zoom:14,zoomAnimation:!0,zoomAnimationThreshold:1,maxZoom:18,minZoom:12,scrollWheelZoom:!0,style:{zIndex:0},className:"map-container",zoomControl:!1,children:[(0,r.jsx)(s.e,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",updateWhenIdle:!1,updateWhenZooming:!1,keepBuffer:8}),(0,r.jsx)(y,{}),Object.entries(b.B4).map((e,t)=>{var o;let[n,s]=e,c=N[n],i=null===(o=x._L[c])||void 0===o?void 0:o.color;return s.map((e,t)=>{let o=e.map(e=>[Number(e.lat),Number(e.lng)]);return(0,r.jsx)(l.R,{positions:o,color:i||"#333",weight:i?4:2.5,opacity:i?.8:.4,dashArray:i?void 0:"5, 10",children:(0,r.jsx)(a.z,{closeButton:!1,autoPan:!0,children:(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsxs)("span",{className:"font-bold text-base",children:["Route ",c]})})})},"".concat(n,"-").concat(t))})}),Object.entries(e).map(e=>{let[o,n]=e;if(!n.latitude||!n.longitude||!n.route)return null;let s=S(n.route);return t[s]||(t[s]=d().divIcon({className:"custom-marker",html:u.renderToString((0,r.jsx)(k,{letter:s,heading:Number(n.calculatedCourse)})),iconSize:[30,30],iconAnchor:[15,15]})),(0,r.jsx)(c.p,{position:[Number(n.latitude),Number(n.longitude)],icon:t[s],zIndexOffset:1e3,children:(0,r.jsx)(a.z,{closeButton:!1,autoPan:!0,children:(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("span",{className:"font-bold text-base",children:n.route}),(0,r.jsxs)("span",{children:[" (",o,")"]})]})})},o)}),(0,r.jsx)(c.p,{position:[p.P.getState().location.latitude,p.P.getState().location.longitude],icon:d().divIcon({className:"custom-user-location",html:u.renderToString((0,r.jsx)(w,{})),iconSize:[10,10],iconAnchor:[5,5]}),zIndexOffset:2e3,children:(0,r.jsxs)(a.z,{children:["\uD83D\uDCCD Your Location",(0,r.jsx)("br",{}),"Latitude: ",p.P.getState().location.latitude.toFixed(4),", Longitude: ",p.P.getState().location.longitude.toFixed(4)]})})]})}},6176:(e,t,o)=>{o.d(t,{A:()=>l});var r=o(2115);async function n(){let e={};for(let[t,o]of Object.entries((await fetch("https://nyu-go-backend-production.up.railway.app/shuttle-data").then(e=>e.json()).catch(e=>{throw console.error("❌ 请求失败:",e),Error("Failed to fetch shuttle data")})).buses)){let t=o[0].busId,r=o[0].route,n=o[0].latitude,s=o[0].longitude,l=o[0].calculatedCourse;e[t]={route:r,latitude:n,longitude:s,calculatedCourse:l}}return e}var s=o(6688);function l(){let[e,t]=(0,r.useState)({}),o=(0,s.P)();return(0,r.useEffect)(()=>{let e;return n().then(e=>{console.log("\uD83D\uDE8D 首次获取到的公交数据:",e),t(e)}).then(()=>{(e=new WebSocket("wss://nyu-go-backend-production.up.railway.app")).onopen=()=>{console.log("✅ WebSocket 连接已建立")},e.onmessage=e=>{try{let o=JSON.parse(e.data);t(e=>{if(!e[o.busId])return e;{let t=o.busId,r=o.latitude,n=o.longitude,s=e[t].route,l=e[t].calculatedCourse;return{...e,[t]:{route:s,latitude:r,longitude:n,calculatedCourse:l}}}})}catch(e){console.error("❌ 解析 WebSocket 数据出错:",e)}}}),()=>{if(e)try{e.close(),console.log("❌ WebSocket 连接已关闭")}catch(e){console.error("❌ WebSocket 关闭失败:",e)}}},[]),(0,r.useEffect)(()=>{o.setShuttleData(e)},[e]),e}}}]);