"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[498],{4498:(e,t,l)=>{l.r(t),l.d(t,{default:()=>el});var a=l(5155),s=l(2115),r=l(4085),n=l(9265),i=l(8008),o=l(648),c=l(9927),d=l(9602);let u=c.bL,m=c.l9,x=c.ZL,f=c.bm,h=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(c.hJ,{ref:t,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",l),...s})});h.displayName=c.hJ.displayName;let p=s.forwardRef((e,t)=>{let{className:l,children:s,...r}=e;return(0,a.jsxs)(x,{children:[(0,a.jsx)(h,{}),(0,a.jsx)(c.UC,{ref:t,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",l),...r,children:s})]})});p.displayName=c.UC.displayName;let v=e=>{let{className:t,...l}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...l})};v.displayName="DialogHeader";let j=e=>{let{className:t,...l}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...l})};j.displayName="DialogFooter";let g=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(c.hE,{ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",l),...s})});g.displayName=c.hE.displayName;let b=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(c.VY,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",l),...s})});function N(e){let{route:t,isFrom:l,callback:i,defaultStop:c}=e,[d,x]=(0,s.useState)(c),[h,N]=(0,s.useState)([]),w=(0,s.useRef)(null),y=(0,s.useRef)(null);return(0,s.useEffect)(()=>{(async function(){try{let e=await (0,n.rn)(t);N(e)}catch(e){console.error("Error fetching stops:",e)}})()},[t]),(0,s.useEffect)(()=>{x(c),i(c||"-")},[c]),(0,s.useLayoutEffect)(()=>{if(y.current&&w.current){let e=y.current.scrollHeight;w.current.style.height="".concat(e,"px")}},[y.current]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",className:"p-2 text-base w-full max-w-full flex items-center justify-between",children:[(0,a.jsx)("span",{className:"truncate",children:d}),(0,a.jsx)(o.q0c,{className:"shrink-0 text-gray-500"})]})}),(0,a.jsxs)(p,{className:"max-w-[85vw] rounded-lg",children:[(0,a.jsxs)(v,{children:[(0,a.jsxs)(g,{children:["Select ",l?"Departure":"Arrival"," Stop"]}),(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Anyone who has this link will be able to view this."})})]}),(0,a.jsxs)("div",{className:"relative w-full max-h-[50vh] overflow-y-auto",ref:y,children:[(0,a.jsx)("div",{ref:w,className:"absolute top-0 left-[23.5px] w-0.5 ".concat(n._L[t].bgColor," min-h-full")}),h.map((e,s)=>(0,a.jsxs)("div",{className:"relative flex items-center pl-12 pr-4 py-4 transition transform active:scale-95 active:opacity-80 ",onClick:()=>{var a;x(e),i(e),localStorage.setItem("route_".concat(t,"_").concat(l),e),null===(a=document.querySelector('[data-state="open"]'))||void 0===a||a.click()},children:[(0,a.jsx)("div",{className:"absolute left-4 w-4 h-4 rounded-full border-2 ".concat(d===e?"".concat(n._L[t].bgColor," border-white shadow"):"bg-white ".concat(n._L[t].borderColor))}),(0,a.jsx)("div",{className:"text-base",children:e})]},s))]}),(0,a.jsx)(j,{className:"sm:justify-start",children:(0,a.jsx)(f,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"secondary",children:"Close"})})})]})]})})}function w(e){let{isOpen:t,onClose:l,name:r,from:c,to:d}=e,[u,m]=(0,s.useState)(c),[x,f]=(0,s.useState)(d),[h,p]=(0,s.useState)([]),[v,j]=(0,s.useState)([]),[g,b]=(0,s.useState)(null),w=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!t)return;let e=document.body.style.overflow,l=document.documentElement.style.overflow;return document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow=e,document.documentElement.style.overflow=l}},[t]),(0,s.useEffect)(()=>{if(!t)return;let e=window.setTimeout(()=>{var e,t;let l=null===(e=w.current)||void 0===e?void 0:e.querySelector('button[aria-label="Close"], [data-sidebar-close]');l?l.focus():null===(t=w.current)||void 0===t||t.focus()},0);return()=>window.clearTimeout(e)},[t]),(0,s.useEffect)(()=>{if(!t)return;let e=w.current;if(e)return e.addEventListener("keydown",a),()=>e.removeEventListener("keydown",a);function a(t){if("Escape"===t.key){t.preventDefault(),l();return}if("Tab"!==t.key||!e)return;let a=Array.from(e.querySelectorAll('a[href],button:not([disabled]),textarea:not([disabled]),input:not([disabled]),select:not([disabled]),[tabindex]:not([tabindex="-1"])'));if(0===a.length)return;let s=a[0],r=a[a.length-1];t.shiftKey?document.activeElement===s&&(t.preventDefault(),r.focus()):document.activeElement===r&&(t.preventDefault(),s.focus())}},[t,l]),(0,s.useEffect)(()=>{(async()=>{let{fromSchedule:e,toSchedule:t}=await (0,n.A0)(r,u,x);p(e),j(t)})()},[r,u,x]),(0,s.useEffect)(()=>{m(c),f(d)},[c,d]),(0,s.useEffect)(()=>{for(let e=0;e<h.length;e++){let[t,l]=h[e].split(" "),[a,s]=t.split(":").map(Number);"PM"===l&&12!==a&&(a+=12);let r=new Date;if(60*a+s>=60*r.getHours()+r.getMinutes()){b(e);break}}},[h,v]),(0,a.jsxs)(a.Fragment,{children:[t&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 !mt-0",onTouchMove:e=>e.preventDefault()}),(0,a.jsxs)(i.P.div,{ref:w,tabIndex:-1,className:"fixed !top-0 !mt-0 right-0 h-full w-full bg-white z-50 outline-none flex flex-col safe-area overscroll-contain",role:"dialog","aria-modal":"true",initial:{x:"100%"},animate:{x:t?0:"100%"},transition:{type:"spring",stiffness:300,damping:30},drag:"x",dragConstraints:{left:0,right:0},dragElastic:.2,onDragEnd:(e,t)=>{t.offset.x>100&&l()},children:[(0,a.jsx)("div",{className:"p-4 flex items-center",children:(0,a.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 text-base font-semibold","aria-label":"Close","data-sidebar-close":!0,onClick:l,children:[(0,a.jsx)(o.xKz,{className:"text-2xl"}),(0,a.jsx)("span",{children:"Back"})]})}),(0,a.jsxs)("div",{className:"text-2xl font-bold px-4",children:["Route ",r]}),(0,a.jsxs)("div",{className:"flex p-4 border-b items-center",children:[(0,a.jsx)("div",{className:"flex-1 overflow-hidden whitespace-nowrap text-ellipsis",children:(0,a.jsx)(N,{route:r,isFrom:!0,callback:m,defaultStop:c})}),(0,a.jsx)(o.MTo,{className:"mx-1 flex-shrink-0"}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden whitespace-nowrap text-ellipsis",children:(0,a.jsx)(N,{route:r,isFrom:!1,callback:f,defaultStop:d})})]}),(0,a.jsxs)("div",{className:"flex px-4 overflow-y-auto",children:[(0,a.jsx)("div",{className:"w-1/2",children:h.map((e,t)=>(0,a.jsx)("div",{className:"text-center mt-2 h-6 ".concat(t===g?"bg-slate-300 animate-pulse font-bold rounded-l-lg":""),children:e},t))}),(0,a.jsxs)("div",{className:"w-1/2",children:[v.map((e,t)=>(0,a.jsx)("div",{className:"text-center mt-2 h-6 ".concat(t===g?"bg-slate-300 animate-pulse font-bold rounded-r-lg":""),children:e},t)),(0,a.jsx)("div",{className:"w-full h-16"})]})]})]})]})}b.displayName=c.VY.displayName;var y=l(6688);function S(e){let{time:t,route:l}=e;return(0,a.jsx)("div",{className:"pr-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"ml-0",children:[Number(t)>=60&&(0,a.jsxs)("span",{className:"inline",children:[(0,a.jsx)("span",{className:"inline text-4xl font-mono",children:Math.floor(Number(t)/60)}),(0,a.jsx)("span",{className:"inline ml-1 mr-1 text-gray-500 text-end",children:"h"})]}),(0,a.jsx)("span",{className:"inline-block text-4xl font-mono min-w-[2ch] text-center",children:"--"===t?"--":(Number(t)%60).toString().padStart(2,"0")}),(0,a.jsx)("span",{className:"inline ml-1 ".concat("--"!==t?"text-gray-500":"text-white"," text-end"),children:"min"})]})})}function C(e){let{route:t,isFrom:l,callback:i}=e,[c,d]=(0,s.useState)("Select Stop"),[x,h]=(0,s.useState)([]),[N,w]=(0,s.useState)(!1),S=(0,s.useRef)(null),C=(0,s.useRef)(null),k=(0,y.P)(e=>e.currentLocation);function E(){C.current&&S.current&&(console.log("\uD83D\uDCCF 计算竖线高度:",C.current.scrollHeight),S.current.style.height="".concat(C.current.scrollHeight,"px"))}return(0,s.useEffect)(()=>{(async function(){try{let e=await (0,n.rn)(t);h(e)}catch(e){console.error("Error fetching stops:",e)}})()},[t]),(0,s.useEffect)(()=>{let e=localStorage.getItem("route_".concat(t,"_").concat(l));e&&(d(e),i(e))},[]),(0,s.useEffect)(()=>{l&&k&&(d(k),i(k))},[k]),(0,s.useEffect)(()=>{N&&requestAnimationFrame(E)},[N,x]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u,{open:N,onOpenChange:w,children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",className:"p-2 text-base w-full max-w-full flex items-center justify-between shadow-none",children:[(0,a.jsx)("span",{className:"truncate",children:c}),(0,a.jsx)(o.q0c,{className:"shrink-0 text-gray-500"})]})}),(0,a.jsxs)(p,{className:"max-w-[85vw] rounded-lg",children:[(0,a.jsxs)(v,{children:[(0,a.jsxs)(g,{children:["Select ",l?"Departure":"Arrival"," Stop"]}),(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Anyone who has this link will be able to view this."})})]}),(0,a.jsxs)("div",{className:"relative w-full max-h-[50vh] overflow-y-auto",ref:C,children:[(0,a.jsx)("div",{ref:S,className:"absolute top-0 left-[23.5px] w-0.5 ".concat(n._L[t].bgColor," min-h-full")}),x.map((e,s)=>(0,a.jsxs)("div",{className:"relative flex items-center pl-12 pr-4 py-4 transition transform",onClick:()=>{var a;d(e),i(e),localStorage.setItem("route_".concat(t,"_").concat(l),e),null===(a=document.querySelector('[data-state="open"]'))||void 0===a||a.click()},children:[(0,a.jsx)("div",{className:"absolute left-4 w-4 h-4 rounded-full border-2 ".concat(c===e?"".concat(n._L[t].bgColor," border-white shadow"):"bg-white ".concat(n._L[t].borderColor))}),(0,a.jsx)("div",{className:"text-base",children:e})]},s))]}),(0,a.jsx)(j,{className:"sm:justify-start",children:(0,a.jsx)(f,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"secondary",children:"Close"})})})]})]})})}function k(e){let{route:t,isFrom:l,callback:s,stops:r}=e;return(0,a.jsxs)("div",{className:"w-full mt-2 truncate",children:[(0,a.jsx)(C,{route:t,isFrom:l,callback:s}),r.map((e,t)=>(0,a.jsx)("div",{className:"text-base text-center mt-2",children:e},t))]})}var E=l(4461);function _(e){let{route:t,promo:l}=e,[r,n]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{"true"===localStorage.getItem(t)?n(!0):n(!1)},[]),(0,a.jsxs)("div",{className:"w-full h-40 shadow rounded p-4 flex flex-col transition-all ".concat(r?"bg-egg-blue-400 text-white":"bg-white text-black"),onClick:()=>{n(!r),localStorage.setItem(t,(!r).toString())},children:[(0,a.jsxs)("div",{className:"flex flex-row items-center",children:[(0,a.jsxs)("span",{className:"text-lg font-bold",children:["Route ",t]}),(0,a.jsx)(o.lEn,{className:"ml-auto w-6 h-6 shadow-none text-white"})]}),(0,a.jsx)("p",{className:"text-sm mt-6",children:l})]})}function L(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsx)("div",{className:"flex items-center justify-cente w-full border px-2 rounded-full",children:(0,a.jsxs)(r.$,{variant:"ghost",className:"p-1 text-base w-full max-w-full  text-gray-400",children:[(0,a.jsx)(o.Raw,{className:"shrink-0 text-gray-400"}),"Edit Routes"]})})}),(0,a.jsxs)(p,{className:"max-w-[90vw] max-h-[100vh] overflow-hidden p-4 rounded",children:[(0,a.jsxs)(v,{children:[(0,a.jsx)(g,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Edit Routes"})}),(0,a.jsx)(b,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden",children:"Edit Routes"})})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:Object.keys(n._L).map((e,t)=>(0,a.jsx)(_,{route:e,promo:n._L[e].promo},t))}),(0,a.jsx)(j,{className:"relative",children:(0,a.jsx)(f,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"outline",className:"fixed h-10 w-20 bottom-12 left-1/2 transform -translate-x-1/2 border border-egg-blue-400 rounded-full text-egg-blue-400 text-base z-50",children:"Save"})})})]})]})})}var D=l(9847);let M=e=>{let{shouldScaleBackground:t=!0,...l}=e;return(0,a.jsx)(D._s.Root,{shouldScaleBackground:t,...l})};M.displayName="Drawer";let A=D._s.Trigger,P=D._s.Portal;D._s.Close;let R=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(D._s.Overlay,{ref:t,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80",l),...s})});R.displayName=D._s.Overlay.displayName;let I=s.forwardRef((e,t)=>{let{className:l,children:s,...r}=e;return(0,a.jsxs)(P,{children:[(0,a.jsx)(R,{}),(0,a.jsxs)(D._s.Content,{ref:t,className:(0,d.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",l),...r,children:[(0,a.jsx)("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]})});I.displayName="DrawerContent";let F=e=>{let{className:t,...l}=e;return(0,a.jsx)("div",{className:(0,d.cn)("grid gap-1.5 p-0 text-center sm:text-left",t),...l})};F.displayName="DrawerHeader";let z=e=>{let{className:t,...l}=e;return(0,a.jsx)("div",{className:(0,d.cn)("mt-auto flex flex-col gap-2 p-0",t),...l})};z.displayName="DrawerFooter";let O=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(D._s.Title,{ref:t,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",l),...s})});O.displayName=D._s.Title.displayName;let $=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)(D._s.Description,{ref:t,className:(0,d.cn)("text-sm text-muted-foreground",l),...s})});$.displayName=D._s.Description.displayName;let T=s.forwardRef((e,t)=>{let{className:l,type:s,...r}=e;return(0,a.jsx)("input",{type:s,className:(0,d.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",l),ref:t,...r})});T.displayName="Input";var q=l(2434),H=l(4389),B=l(3032);function J(){let[e,t]=(0,s.useState)(null),[l,c]=(0,s.useState)(""),[d,u]=(0,s.useState)("-"),[m,x]=(0,s.useState)(y.P.getState().stopsData),[f,h]=(0,s.useState)(JSON.parse(localStorage.getItem("bookmarkedStops")||"[]")),[p,v]=(0,s.useState)(null),j=(0,y.P)(e=>e.location),g=(0,y.P)(e=>e.enableAutoNearestStop),b=(0,y.P)(e=>e.setEnableAutoNearestStop),N=(0,y.P)(e=>e.updateCurrentLocation);(0,s.useEffect)(()=>{t(y.P.getState().stopsData),u(y.P.getState().currentLocation||"-")},[]),(0,s.useEffect)(()=>{if(j&&e&&j&&e){let t=1/0,l=null;if(Object.entries(e).forEach(e=>{let[a,s]=e,r=(0,H.$)(j.latitude,j.longitude,s.position.latitude,s.position.longitude);r<t&&(t=r,l=a)}),l){v(l),g&&(u(l),N(l));return}}},[j,e,g]);let w=e=>{if(c(e),!e){x(y.P.getState().stopsData);return}let t=y.P.getState().stopsData;x(Object.keys(t).reduce((l,a)=>((0,q.A)(a,e)&&(l[a]=t[a]),l),{}))},S=e=>{let t=f.includes(e)?f.filter(t=>t!==e):[...f,e];h(t),localStorage.setItem("bookmarkedStops",JSON.stringify(t))},C=(0,s.useMemo)(()=>m?Object.entries(m).sort((e,t)=>{let[l]=e,[a]=t;return(f.includes(l)?-1:1)-(f.includes(a)?-1:1)}):[],[m,f]),k=e=>{u(e),N(e),b&&b(!1),localStorage.setItem("currentLocation",e);let t=document.querySelector('[data-state="open"]');t instanceof HTMLElement&&t.click()},E=e=>{let{stopKey:t,value:l,showBookmark:s=!0}=e;return(0,a.jsxs)("div",{className:"flex flex-row py-4 border-b transition transform active:scale-95 active:opacity-80",onClick:()=>k(t),children:[(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[(0,a.jsx)("div",{className:"text-lg mb-1 inline",children:t}),(0,a.jsx)("div",{children:l.routes.map((e,t)=>{var l;return(0,a.jsx)("div",{className:"inline mr-2 p-3 py-1 text-xs rounded-md text-gray-900 font-bold",style:{backgroundColor:null===(l=n._L[e])||void 0===l?void 0:l.color},children:e},t)})})]}),s&&(0,a.jsx)("div",{className:"flex flex-col justify-center",children:f.includes(t)?(0,a.jsx)(o.cgZ,{className:"ml-2 text-amber-400 w-7 h-7",onClick:e=>{e.stopPropagation(),S(t)}}):(0,a.jsx)(o.WKI,{className:"ml-2 text-gray-500 w-7 h-7",onClick:e=>{e.stopPropagation(),S(t)}})})]})};return(0,a.jsxs)(M,{children:[(0,a.jsx)(A,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",className:"p-1 text-base w-full max-w-full",children:[(0,a.jsx)(o.Cud,{className:"shrink-0 text-gray-500"}),(0,a.jsx)("span",{className:"truncate",children:d})]})}),(0,a.jsxs)(I,{className:"h-[85vh]",children:[(0,a.jsxs)(F,{children:[(0,a.jsx)(O,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden p-0",children:"Select Location"})}),(0,a.jsx)($,{asChild:!0,children:(0,a.jsx)("div",{className:"hidden p-0",children:"Select Location"})})]}),(0,a.jsxs)("div",{className:"flex justify-center w-full py-4",style:{boxShadow:"0 4px 4px -3px rgba(0, 0, 0, 0.1)"},children:[(0,a.jsx)(T,{placeholder:"Search a stop",className:"w-[55%] shadow-none rounded-full text-lg",value:l,onChange:e=>w(e.target.value)}),(0,a.jsx)(o.EO$,{className:"w-8 h-8 text-gray-400 ml-2"})]}),(0,a.jsxs)("div",{className:"flex flex-col h-full overflow-y-auto px-8",children:[(0,a.jsxs)(B.o,{children:[(0,a.jsx)(i.P.div,{layoutId:"nearest-stop",children:p&&(0,a.jsx)(t=>{var l;let{stopKey:s}=t;return(0,a.jsx)("div",{className:"flex flex-row py-8 border-b transition transform active:scale-95 active:opacity-80",onClick:()=>k(s),children:(0,a.jsxs)("div",{className:"flex flex-col w-full justify-center",children:[(0,a.jsx)("div",{className:"mb-1",children:(0,a.jsxs)("div",{className:"text-sm text-gray-400 mb-1 inline animate-pulse",children:[(0,a.jsx)(o.Ohz,{className:"inline mr-1"}),(0,a.jsx)("span",{className:"align-text-top font-bold",children:"Nearest Stop"})]})}),(0,a.jsxs)("div",{className:"block",children:[(0,a.jsx)("div",{className:"text-lg mb-1 inline",children:s}),(0,a.jsx)("div",{children:e&&(null===(l=e[s])||void 0===l?void 0:l.routes.map((e,t)=>{var l;return(0,a.jsx)("div",{className:"inline mr-2 p-3 py-1 text-xs rounded-md text-gray-900 font-bold",style:{backgroundColor:null===(l=n._L[e])||void 0===l?void 0:l.color},children:e},t)}))})]})]})})},{stopKey:p})},"nearest-stop"),C.map(e=>{let[t,l]=e;return(0,a.jsx)(i.P.div,{layout:!0,layoutId:t,transition:{layout:{duration:.5,ease:"easeInOut"}},children:(0,a.jsx)(E,{stopKey:t,value:l})},t)})]}),0===Object.keys(m).length&&(0,a.jsx)("div",{className:"text-center text-gray-400 py-4 text-lg font-bold",children:"No stop found"})]}),(0,a.jsx)(z,{})]})]})}var K=l(8422),W=l(3463);function G(e){var t,l;let{className:n}=e,[i,o]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=new AbortController,t=async()=>{try{let t=await fetch("https://nyu-go-backend-production.up.railway.app/alert-messages",{signal:e.signal}),l=await t.json();o(l)}catch(e){e instanceof Error&&"AbortError"!==e.name&&console.error("❌ 获取 alert 消息失败:",e)}};t();let l=setInterval(t,6e4);return()=>{e.abort(),clearInterval(l)}},[]);let c=null!==(l=null==i?void 0:null===(t=i.msgs)||void 0===t?void 0:t.length)&&void 0!==l?l:0;return(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(r.$,{className:(0,W.A)("rounded-full p-2 w-9 h-9 relative",n),variant:"outline",children:[(0,a.jsx)(K.Bwk,{className:"h-4 w-4"}),c>0&&(0,a.jsx)("span",{className:"absolute top-0 right-0 block w-2 h-2 rounded-full bg-red-600"})]})}),(0,a.jsx)(p,{className:"w-[90vw] rounded-lg",children:(0,a.jsxs)(v,{children:[(0,a.jsx)(g,{children:"Alert Messages"}),(0,a.jsx)(b,{}),c>0?(0,a.jsx)("div",{className:"text-left",children:i.msgs.map(e=>(0,a.jsxs)("div",{className:"my-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.created}),(0,a.jsx)("div",{className:"font-bold",children:e.name}),(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:e.html}})]},e.id))}):(0,a.jsx)("div",{children:"No alert messages"})]})})]})}var Z=l(5007),V=l(9627),U=l(5565);let X=[{img:"/guide/guide_1.jpg",description:"Description 1"},{img:"/guide/guide_2.jpg",description:"Description 2"},{img:"/guide/guide_3.jpg",description:"Description 3"},{img:"/guide/guide_4.jpg",description:"Description 4"},{img:"/guide/guide_5.jpg",description:"Description 5"}];function Y(){let[e,t]=s.useState(),[l,n]=s.useState(0),[i,o]=s.useState(0);return s.useEffect(()=>{e&&(o(e.scrollSnapList().length),n(e.selectedScrollSnap()+1),e.on("select",()=>n(e.selectedScrollSnap()+1)))},[e]),(0,a.jsxs)("div",{className:"mx-auto w-full px-2 sm:px-4",children:[(0,a.jsxs)(V.FN,{setApi:t,children:[(0,a.jsx)(V.Wk,{children:X.map((e,t)=>(0,a.jsx)(V.A7,{children:(0,a.jsx)(Z.Zp,{className:"border-0 shadow-none",children:(0,a.jsx)(Z.Wu,{className:"flex flex-col items-center justify-center p-0",children:(0,a.jsx)(U.default,{width:500,height:500,src:e.img,alt:"Slide ".concat(t+1),className:"max-h-[60vh] sm:max-h-[65vh] object-contain"})})})},t))}),(0,a.jsx)("div",{className:"py-4 flex items-center justify-center gap-3",children:Array.from({length:i}).map((t,s)=>(0,a.jsx)("button",{type:"button","aria-label":"Go to slide ".concat(s+1),onClick:()=>null==e?void 0:e.scrollTo(s),className:"h-4 w-4 rounded-full border-[3px] transition-colors ".concat(l===s+1?"border-foreground bg-transparent":"border-gray-300 bg-transparent")},s))})]}),l===i&&(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(f,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",className:"animate-in fade-in-0 slide-in-from-bottom-2 duration-300 font-bold gap-0 text-lg",children:"Got it!"})})})]})}function Q(e){let{className:t}=e,l=window.matchMedia("(display-mode: standalone)").matches||void 0!==window.navigator&&"standalone"in window.navigator&&!0===window.navigator.standalone;return(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{asChild:!0,children:(0,a.jsxs)(r.$,{className:(0,W.A)("rounded-full p-2 w-9 h-9 relative",t),variant:"outline",children:[(0,a.jsx)(o.xRM,{className:"h-4 w-4"}),!l&&(0,a.jsx)("span",{className:"absolute top-0 right-0 block w-2 h-2 rounded-full bg-red-600"})]})}),(0,a.jsxs)(p,{className:"w-[92vw] max-w-[900px] max-h-[90vh] overflow-hidden rounded-lg p-0",children:[(0,a.jsx)(v,{className:"p-4 pb-0",children:(0,a.jsx)(g,{className:"text-lg font-semibold leading-none tracking-tight",children:"Add to Home Screen"})}),(0,a.jsx)("div",{className:"h-full max-h-[90vh] overflow-y-auto p-4 pt-2 pb-4",children:(0,a.jsx)(Y,{})})]})]})}let ee=[{name:"A",time:"4",color:"pink"},{name:"B",time:"5",color:"purple"},{name:"C",time:"8",color:"yellow"},{name:"E",time:"8",color:"yellow"},{name:"F",time:"3",color:"green"},{name:"G",time:"6",color:"cyan"},{name:"W",time:"7",color:"amber"}],et=(0,s.memo)(function(e){var t;let{name:l}=e,{time:i,actualTime:c,stopFrom:d,stopTo:u,currentStopFrom:m,currentStopTo:x,setCurrentStopFrom:f,setCurrentStopTo:h}=function(e){let[t,l]=(0,s.useState)(null),[a,r]=(0,s.useState)(null),[i,o]=(0,s.useState)(["-"]),[c,d]=(0,s.useState)(["-"]),[u,m]=(0,s.useState)(""),[x,f]=(0,s.useState)(""),h=(0,y.P)();return(0,y.P)(e=>e.currentLocation),(0,s.useEffect)(()=>{let t=async()=>{let t=await (0,n.A1)(e,h.currentLocation);l(-1===t?"--":t.toString())};t();let a=setInterval(t,5e3);return()=>clearInterval(a)},[e,h.currentLocation]),(0,s.useEffect)(()=>{(async()=>{let{fromSchedule:t,toSchedule:l}=await (0,n.fP)(e,u,x);o(t),d(l)})()},[e,u,x]),{time:t,actualTime:a,stopFrom:i,stopTo:c,currentStopFrom:u,currentStopTo:x,setCurrentStopFrom:m,setCurrentStopTo:f}}(l),[p,v]=(0,s.useState)(!1),[j,g]=(0,s.useState)(!1),b=(0,n.pE)(l),N="",C=d,_=u;return d.length<=0?(N="Departure stop not available",C=[],_=[]):u.length<=0&&(N="Arrival stop not available",C=[],_=[]),(0,a.jsxs)(a.Fragment,{children:[b&&(0,a.jsxs)("div",{className:"flex flex-col items-center rounded-lg shadow-sm mt-1 border-l-[8px] bg-white relative",style:{borderLeftColor:null===(t=n._L[l])||void 0===t?void 0:t.color},children:[(0,a.jsxs)("div",{className:"flex items-center w-full h-20",onClick:()=>v(!p),children:[(0,a.jsx)("div",{className:"ml-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline text-4xl font-mono",children:l})}),(0,a.jsx)(E.A,{routeName:l,className:"mx-4"}),(0,a.jsx)(S,{time:i,route:l})]}),(0,a.jsxs)("div",{className:"overflow-hidden transition-all duration-500 ".concat(p?"max-h-[400px] opacity-100":"max-h-0 opacity-0"," items-center w-full"),children:[(0,a.jsxs)("div",{className:"flex-col p-2",children:[(0,a.jsxs)("div",{className:"flex flex-grow-0",children:[(0,a.jsx)(k,{route:l,isFrom:!0,callback:f,stops:C}),(0,a.jsx)(o.MTo,{className:"mt-2 w-8 h-8 mx-1"}),(0,a.jsx)(k,{route:l,isFrom:!1,callback:h,stops:_})]}),N&&(0,a.jsx)("div",{className:"text-gray-400 text-base text-center mt-4",children:N})]}),(0,a.jsxs)("div",{className:"flex flex-row space-x-2 m-2 mt-6",children:[(0,a.jsx)(r.$,{onClick:()=>g(!0),variant:"outline",className:"h-12 rounded-full text-base ml-auto",style:{borderColor:n._L[l].color},children:"Full Schedule"}),(0,a.jsx)(r.$,{onClick:()=>{window.location.href="/main/map"},variant:"secondary",className:"h-12 rounded-full text-base text-gray-50",style:{backgroundColor:n._L[l].color},children:"Open Map"})]})]})]}),!b&&(0,a.jsx)("div",{className:"flex flex-col items-center rounded-lg shadow-sm mt-1 border-l-[8px] border-gray-400 bg-gray-100 relative",children:(0,a.jsx)("div",{className:"flex items-center w-full h-20",children:(0,a.jsx)("div",{className:"ml-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline text-4xl font-mono text-gray-400",children:l})})})}),(0,a.jsx)(w,{isOpen:j,onClose:()=>g(!1),name:l,from:m,to:x})]})});function el(){var e;let[t,l]=(0,s.useState)([]);(0,y.P)();let r=(0,s.useMemo)(()=>ee.map(e=>e.name).filter(e=>"true"===localStorage.getItem(e)),[t]),n=(0,s.useCallback)(()=>{let e=ee.map(e=>e.name).filter(e=>"true"===localStorage.getItem(e));l(t=>JSON.stringify(t)===JSON.stringify(e)?t:e)},[]);(0,s.useEffect)(()=>{n();let e=setInterval(n,500);return()=>clearInterval(e)},[n]);let i=(0,s.useMemo)(()=>(0,a.jsx)(J,{}),[]),o=(0,y.P)(e=>e.insets);return(0,a.jsxs)("div",{className:"p-4 h-screen overflow-y-auto",style:{marginTop:null!==(e=null==o?void 0:o.top)&&void 0!==e?e:0},children:[(0,a.jsxs)("div",{className:"flex mb-6 items-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Track"}),(0,a.jsx)(Q,{className:"ml-auto mr-4"}),(0,a.jsx)(G,{})]}),(0,a.jsxs)("div",{className:"mb-8 text-base",children:["Departing from \xa0",(0,a.jsx)("div",{className:"max-w-48 inline-block",children:i}),"\xa0 in"]}),(0,a.jsxs)("div",{className:"space-y-6",children:[ee.map((e,t)=>r.includes(e.name)&&(0,a.jsx)(et,{name:e.name},t)),(0,a.jsx)("div",{className:"flex justify-center items-center",children:(0,a.jsx)("div",{className:"w-32",children:(0,a.jsx)(L,{})})}),(0,a.jsx)("div",{className:"w-full h-16"})]})]})}},4461:(e,t,l)=>{l.d(t,{A:()=>d});var a=l(5155),s=l(9265),r=l(2115),n=l(6688),i=l(2364),o=l(2434),c=l(4389);function d(e){var t;let{routeName:l,progress:d,className:u}=e,m=(0,n.P)(e=>e.unit),x=d||function(e){let t=(0,n.P)(),[l,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let l=function(e){let t=Object.values(i.Gb).find(t=>(0,o.A)(t.name,e));return t?{latitude:t.latitude,longitude:t.longitude}:(console.error("Stop ".concat(e," not found")),null)}(t.currentLocation);if(l){let s=function(e,l,a){let s=t.shuttleData;if(!s||Object.prototype.hasOwnProperty.call(s,"undefined"))return null;let r=1/0,n=null;return Object.entries(s).forEach(t=>{let[s,i]=t;if(i.route.toLowerCase()===e.toLowerCase()){let e=(0,c.$)(l,a,Number(i.latitude),Number(i.longitude));e<r&&(r=e,n={latitude:i.latitude,longitude:i.longitude})}}),n}("route "+e,l.latitude,l.longitude);s&&a(Number((0,c.$)(Number(s.latitude),Number(s.longitude),l.latitude,l.longitude)))}},[t.shuttleData,t.currentLocation,e]),l}(l),f=null===x?0:Math.min(100,Math.max(0,100*(1-Math.log1p(Math.max(0,Math.min(x,3)))/Math.log1p(3)))),h=Math.min(90,Math.max(15,f)),p=function(e,t){if(null===e)return null;if("imperial"===t){let t=.621371*e;if(t>1)return"".concat(t.toFixed(1)," mi");{let t=3280.84*e;return"".concat(t.toFixed(0)," ft")}}return e>1?"".concat(e.toFixed(1)," km"):"".concat((1e3*e).toFixed(0)," m")}(x,m);return(0,a.jsxs)("div",{className:"relative h-1 w-full rounded-full bg-gray-200 ".concat(u),children:[(0,a.jsx)("div",{className:"h-full rounded-full transition-all duration-1000",style:{width:"".concat(f,"%"),backgroundColor:(null===(t=s._L[l])||void 0===t?void 0:t.color)||"#1DADAF"}}),(0,a.jsx)("div",{className:"absolute text-gray-500 text-sm whitespace-nowrap animate-pulse",style:{left:"".concat(h,"%"),transform:"translateX(-50%)",bottom:"100%",marginBottom:"4px"},children:null===p?"":"".concat(p)})]})}},4389:(e,t,l)=>{l.d(t,{$:()=>a});function a(e,t,l,a){let s=(l-e)*Math.PI/180,r=(a-t)*Math.PI/180,n=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e*Math.PI/180)*Math.cos(l*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}},4085:(e,t,l)=>{l.d(t,{$:()=>c,r:()=>o});var a=l(5155),s=l(2115),r=l(4707),n=l(1027),i=l(9602);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:l,variant:s,size:n,asChild:c=!1,...d}=e,u=c?r.DX:"button";return(0,a.jsx)(u,{className:(0,i.cn)(o({variant:s,size:n,className:l})),ref:t,...d})});c.displayName="Button"},5007:(e,t,l)=>{l.d(t,{Wu:()=>i,Zp:()=>n});var a=l(5155),s=l(2115),r=l(9602);let n=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("rounded-xl border bg-card text-card-foreground shadow",l),...s})});n.displayName="Card",s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",l),...s})}).displayName="CardHeader",s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("font-semibold leading-none tracking-tight",l),...s})}).displayName="CardTitle",s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",l),...s})}).displayName="CardDescription";let i=s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",l),...s})});i.displayName="CardContent",s.forwardRef((e,t)=>{let{className:l,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",l),...s})}).displayName="CardFooter"},9627:(e,t,l)=>{l.d(t,{A7:()=>f,FN:()=>m,Wk:()=>x});var a=l(5155),s=l(2115),r=l(2576),n=l(7364),i=l(9053),o=l(9602),c=l(4085);let d=s.createContext(null);function u(){let e=s.useContext(d);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}let m=s.forwardRef((e,t)=>{let{orientation:l="horizontal",opts:n,setApi:i,plugins:c,className:u,children:m,...x}=e,[f,h]=(0,r.A)({...n,axis:"horizontal"===l?"x":"y"},c),[p,v]=s.useState(!1),[j,g]=s.useState(!1),b=s.useCallback(e=>{e&&(v(e.canScrollPrev()),g(e.canScrollNext()))},[]),N=s.useCallback(()=>{null==h||h.scrollPrev()},[h]),w=s.useCallback(()=>{null==h||h.scrollNext()},[h]),y=s.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),N()):"ArrowRight"===e.key&&(e.preventDefault(),w())},[N,w]);return s.useEffect(()=>{h&&i&&i(h)},[h,i]),s.useEffect(()=>{if(h)return b(h),h.on("reInit",b),h.on("select",b),()=>{null==h||h.off("select",b)}},[h,b]),(0,a.jsx)(d.Provider,{value:{carouselRef:f,api:h,opts:n,orientation:l||((null==n?void 0:n.axis)==="y"?"vertical":"horizontal"),scrollPrev:N,scrollNext:w,canScrollPrev:p,canScrollNext:j},children:(0,a.jsx)("div",{ref:t,onKeyDownCapture:y,className:(0,o.cn)("relative",u),role:"region","aria-roledescription":"carousel",...x,children:m})})});m.displayName="Carousel";let x=s.forwardRef((e,t)=>{let{className:l,...s}=e,{carouselRef:r,orientation:n}=u();return(0,a.jsx)("div",{ref:r,className:"overflow-hidden",children:(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex","horizontal"===n?"-ml-4":"-mt-4 flex-col",l),...s})})});x.displayName="CarouselContent";let f=s.forwardRef((e,t)=>{let{className:l,...s}=e,{orientation:r}=u();return(0,a.jsx)("div",{ref:t,role:"group","aria-roledescription":"slide",className:(0,o.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===r?"pl-4":"pt-4",l),...s})});f.displayName="CarouselItem",s.forwardRef((e,t)=>{let{className:l,variant:s="outline",size:r="icon",...i}=e,{orientation:d,scrollPrev:m,canScrollPrev:x}=u();return(0,a.jsxs)(c.$,{ref:t,variant:s,size:r,className:(0,o.cn)("absolute  h-8 w-8 rounded-full","horizontal"===d?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",l),disabled:!x,onClick:m,...i,children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Previous slide"})]})}).displayName="CarouselPrevious",s.forwardRef((e,t)=>{let{className:l,variant:s="outline",size:r="icon",...n}=e,{orientation:d,scrollNext:m,canScrollNext:x}=u();return(0,a.jsxs)(c.$,{ref:t,variant:s,size:r,className:(0,o.cn)("absolute h-8 w-8 rounded-full","horizontal"===d?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",l),disabled:!x,onClick:m,...n,children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Next slide"})]})}).displayName="CarouselNext"},9602:(e,t,l)=>{l.d(t,{cn:()=>r});var a=l(3463),s=l(9795);function r(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];return(0,s.QP)((0,a.$)(t))}}}]);