"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[183],{9183:(e,t,o)=>{o.r(t),o.d(t,{default:()=>z});var r=o(5155),n=o(833),l=o(5402),s=o(3710),i=o(3314),a=o(8741),u=o.n(a),c=o(5687),d=o(2115);o(8413),o(9149),o(3919);var h=o(6176),b=o(2432),m=o(6688),p=o(6756),x=o(2364);let f=e=>e<=11?0:e>=16?1:(e-11)/5,g=e=>{let{opacity:t=1}=e;return(0,r.jsx)("div",{className:"w-2 h-2 flex items-center justify-center rounded-full bg-white border-2 border-gray-500",style:{opacity:t}})},j=()=>{let e=(0,p.ko)(),[t,o]=(0,d.useState)(e.getZoom());(0,d.useEffect)(()=>{let t=()=>{o(e.getZoom())};return e.on("zoomend",t),()=>{e.off("zoomend",t)}},[e]);let n=f(t);return(0,r.jsx)(r.Fragment,{children:Object.values(x.Gb).map(e=>(0,r.jsx)(s.p,{position:[e.latitude,e.longitude],icon:u().divIcon({className:"custom-stop",html:c.renderToString((0,r.jsx)(g,{opacity:n})),iconSize:[10,10],iconAnchor:[5,5]}),children:(0,r.jsxs)(i.z,{children:[e.name," (",e.id,")"]})},e.id))})},S=e=>{let t=e.split(" ");if(t.length<2)return"?";let o=t[1].match(/[A-Z]/i);return o?o[0].toUpperCase():"?"},y=e=>{var t,o;let{letter:n}=e;return(0,r.jsx)("div",{className:"w-8 h-8 flex items-center justify-center rounded-full bg-white border-2 ".concat(null===(t=b.JZ[n])||void 0===t?void 0:t.borderColor," ").concat(null===(o=b.JZ[n])||void 0===o?void 0:o.textColor," border-black"),style:{boxShadow:"0px 5px 10px rgba(0, 0, 0, 0.25)",transition:"transform 0.3s ease-in-out"},children:(0,r.jsx)("span",{className:"font-black",children:n})})},v=()=>(0,r.jsx)("div",{className:"w-2 h-2 flex items-center justify-center rounded-full bg-blue-400 border-2 border-blue-600",style:{boxShadow:"0px 5px 10px rgba(0, 0, 0, 0.25)"}});function z(){let e=(0,h.A)(),t=(0,d.useMemo)(()=>({}),[]);return(0,r.jsxs)(n.W,{center:[40.73,-73.99],zoom:14,zoomAnimation:!0,zoomAnimationThreshold:4,style:{zIndex:0},className:"map-container",zoomControl:!1,children:[(0,r.jsx)(l.e,{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),(0,r.jsx)(j,{}),Object.entries(e).map(e=>{let[o,n]=e;if(!n.latitude||!n.longitude||!n.route)return null;let l=S(n.route);return t[l]||(t[l]=u().divIcon({className:"custom-marker",html:c.renderToString((0,r.jsx)(y,{letter:l})),iconSize:[30,30],iconAnchor:[15,15]})),(0,r.jsx)(s.p,{position:[Number(n.latitude),Number(n.longitude)],icon:t[l],zIndexOffset:1e3,children:(0,r.jsxs)(i.z,{children:["\uD83D\uDE8C ",n.route,(0,r.jsx)("br",{}),"# ",o,(0,r.jsx)("br",{}),"\uD83D\uDCCD ",Number(n.latitude),", ",Number(n.longitude)]})},o)}),(0,r.jsx)(s.p,{position:[m.P.getState().location.latitude,m.P.getState().location.longitude],icon:u().divIcon({className:"custom-user-location",html:c.renderToString((0,r.jsx)(v,{})),iconSize:[10,10],iconAnchor:[5,5]}),zIndexOffset:2e3,children:(0,r.jsxs)(i.z,{children:["\uD83D\uDCCD Your Location",(0,r.jsx)("br",{}),"Latitude: ",m.P.getState().location.latitude.toFixed(4),", Longitude: ",m.P.getState().location.longitude.toFixed(4)]})})]})}},6176:(e,t,o)=>{o.d(t,{A:()=>s});var r=o(2115);async function n(){let e={};for(let[t,o]of Object.entries((await fetch("https://nyu-go-backend-production.up.railway.app/shuttle-data").then(e=>e.json()).catch(e=>{throw console.error("❌ 请求失败:",e),Error("Failed to fetch shuttle data")})).buses)){let t=o[0].busId,r=o[0].route,n=o[0].latitude,l=o[0].longitude;e[t]={route:r,latitude:n,longitude:l}}return e}var l=o(6688);function s(){let[e,t]=(0,r.useState)({}),o=(0,l.P)();return(0,r.useEffect)(()=>{let e;return n().then(e=>{console.log("\uD83D\uDE8D 首次获取到的公交数据:",e),t(e)}).then(()=>{(e=new WebSocket("wss://nyu-go-backend-production.up.railway.app")).onopen=()=>{console.log("✅ WebSocket 连接已建立")},e.onmessage=e=>{try{let o=JSON.parse(e.data);t(e=>{if(!e[o.busId])return e;{let t=o.busId,r=o.latitude,n=o.longitude,l=e[t].route;return{...e,[t]:{route:l,latitude:r,longitude:n}}}})}catch(e){console.error("❌ 解析 WebSocket 数据出错:",e)}}}),()=>{if(e)try{e.close(),console.log("❌ WebSocket 连接已关闭")}catch(e){console.error("❌ WebSocket 关闭失败:",e)}}},[]),(0,r.useEffect)(()=>{o.setShuttleData(e)},[e]),e}}}]);